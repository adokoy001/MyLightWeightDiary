tags: AWS EC2 Linux Ubuntu
---
# AWSでVPC構築

社会復帰してまだ半年にもならないですが、1年半以上パソコンを触っていないという浦島太郎状態から徐々にキャッチアップできるようになってきたような気がする（錯覚）

最近AWSで本番環境の構築作業をしていたので、メモ代わりに気付いたことを記しておく。ちなみにAWSで本番環境を構築するのは初めてです（今までにSoftbankクラウド、さくらのクラウド、GMOクラウド & Altus、IBMクラウドでWebサーバを構築したことはあります。AWSは個人アカウントの無料枠で試しただけ）

## VPCのアドレス空間

まず初めに、展開するサービスの要件に合わせたアドレス空間でバーチャルプライベートネットワークを構築する。とりあえず 10.X.0.0/16 ぐらい確保しておけば大丈夫だろう。

AWSで複数のサービスを展開することや、不要になったサービスを事業譲渡などで他社に引き渡すことを考えると、プライベートネットワークをサービス単位で構築しておいた方が良い（サービス間連携はプライベートネットワーク内の通信以外の手段で実現する）。

VPNサーバーを立ててメンテ基盤を作ることもあるので、自社内・関係取引先含む既存のネットワークと重ならないアドレス空間が好ましい。

VPCには一つ以上のサブネットが必要。VPCで確保したアドレス空間と同じものを割り当ててよい。

## インターネットゲートウェイを作成

VPCとインターネットを相互接続するためにはインターネットゲートウェイが必要。1つ作成し、割り当てる。

Egress-OnlyではインターネットからVPCに対するアクティブな接続はできないので注意（SSHなど）。

ここまで設定すればうまく動きそうに思えるが、後述するデフォルトゲートウェイの設定を書いてやらなければまだ動かない。

## ルートテーブルの設定

作成したVPCのルートテーブルに、0.0.0.0/0の通信先をインターネットゲートウェイに向けるように設定し、作成したサブネットにも関連付けを施す。

これでやっとうまく動く。

